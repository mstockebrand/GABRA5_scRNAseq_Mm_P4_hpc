#  Normalization and Integration of the dataset

high quality singlet dataset as input for Normalization and integration

###  libraries
    # Libryries already activated before
        #library(dplyr)
        #library(Seurat)
        #library(patchwork)
        #library(ggplot2)
        #library(limma)
        #library(ggrepel)

        # libraries for QC
            #library(ggExtra)
            #library(cowplot)
            #library(Matrix)

        # libraries for doublet removal
          library(DoubletFinder)
          library(glmGamPoi) 

###  Dataset integration and normalization
####  Split layers
    Scn2a.P4[["RNA"]] <- split(Scn2a.P4[["RNA"]], f = Scn2a.P4$sample_no)

###  Normalization with SCTransform
    Scn2a.P4 <- SCTransform(Scn2a.P4, method = "glmGamPoi",                            
                            vars.to.regress = c("nCount_RNA", "percent.mt"))

###  linear dimensionality reduction: PCA ----
    Scn2a.P4 <- RunPCA(Scn2a.P4)

####  Examine and visualize PCA results a few different ways
    print(Scn2a.P4[["pca"]], dims = 1:5, nfeatures = 10)
    print(Scn2a.P4[["pca"]], dims = 1:5, nfeatures = 20)
    
    VizDimLoadings(Scn2a.P4, dims = 1:2, nfeatures = 50, reduction = "pca")
    
    Idents(Scn2a.P4) <- "genotype"
    DimPlot(Scn2a.P4, reduction = "pca")
    DimPlot(Scn2a.P4, reduction = "pca", dims = c(49, 50))  
